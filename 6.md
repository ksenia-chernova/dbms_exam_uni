### Объекты СУБД

Объекты СУБД образуют иерархическую систему, где каждый элемент служит определенной цели — от физического хранения до управления доступом и бизнес-логикой.

---

### **Категория 1: Объекты хранения и структуры данных**

#### **1. База данных (Database)**
*   **Назначение:** Контейнер верхнего уровня, единица администрирования и изоляции. Объединяет все объекты, связанные с одним приложением или задачей.
*   **Свойства:** Имеет собственное файловое пространство на диске (файлы данных `.mdf`/`.ndf` в SQL Server, табличные пространства в Oracle), отдельный журнал транзакций, настройки автосжатия, восстановления и т.д.
*   **Пример:** `AdventureWorks`, `БанковскаяСистема`, `Склад`.

#### **2. Таблица (Table)**
*   **Назначение:** Основная структурная единица хранения данных в реляционной модели. Представляет собой совокупность строк (записей, кортежей) и столбцов (атрибутов, полей).
*   **Свойства:**
    *   Определяется **схемой (структурой)**: именами и типами данных столбцов.
    *   Имеет **ограничения целостности** (PRIMARY KEY, FOREIGN KEY, CHECK, UNIQUE, NOT NULL).
    *   Данные физически хранятся в **страницах**.
*   **Пример:** `Employees`, `Orders`, `Products`.

#### **3. Отношение (Relation)**
*   **Назначение:** **Теоретическое понятие** из реляционной алгебры, соответствующее таблице в реализации. Это множество кортежей (строк), обладающих одинаковыми атрибутами (столбцами).
*   **Ключевое отличие от «таблицы»:** В теории «отношение» не подразумевает порядка строк и столбцов, а также дубликатов строк. Физическая таблица в СУБД — это реализация отношения, которая может иметь физический порядок (кластеризованный индекс) и требует явного устранения дубликатов.

---

### **Категория 2. Объекты для оптимизации и расширения типов**

#### **4. Индекс (Index)**
*   **Назначение:** Вспомогательная структура данных для ускорения поиска и сортировки строк в таблице по определенным столбцам (ключевым).
*   **Принцип работы:** Создает отсортированную копию части данных таблицы (ключевые столбцы + указатель на строку) в эффективной для поиска структуре (B-дерево, хеш-таблица).
*   **Типы:**
    *   **Кластеризованный (Clustered):** Определяет **физический порядок** хранения данных в таблице. Таблица может иметь только один такой индекс.
    *   **Некластеризованный (Non-Clustered):** Отдельная структура, содержащая ключ и указатель на строку данных. Таблица может иметь множество таких индексов.
    *   **Другие:** Уникальные, составные, полнотекстовые, пространственные (GIS).
*   **Компромисс:** Ускоряют чтение, но замедляют операции вставки/обновления/удаления (DML), так как индексы тоже требуют поддержки.

#### **5. Пользовательский тип данных (User-Defined Data Type, UDT)**
*   **Назначение:** Расширение встроенной системы типов СУБД для моделирования предметной области.
*   **Виды:**
    1.  **Псевдоним типа (DOMAIN):** Имя для существующего типа с добавлением ограничений (`CREATE DOMAIN PhoneNumber AS VARCHAR(20) CHECK (...)`).
    2.  **Составной тип (COMPOSITE):** Структура из нескольких полей (аналог `struct` в C). Используется в PostgreSQL.
    3.  **Объектный тип (OBJECT):** Сложный тип с атрибутами и методами (Oracle).
*   **Преимущество:** Повышение семантики, централизация валидации.

---

### **Категория 3. Объекты для абстракции и логики**

#### **6. Представление (View)**
*   **Назначение:** **Виртуальная таблица**, результат сохраненного запроса `SELECT`. Не хранит данные физически, а вычисляет их «на лету» при обращении.
*   **Типы:**
    *   **Простое (Non-materialized):** Запрос выполняется каждый раз.
    *   **Материализованное (Materialized View / Indexed View):** Результат запроса физически сохраняется на диске и периодически обновляется. Торгует актуальностью данных за скорость.
*   **Применение:**
    *   Упрощение сложных запросов.
    *   Обеспечение безопасности (скрытие определенных столбцов или строк).
    *   Абстракция от физической схемы.

#### **7. Хранимая процедура (Stored Procedure)**
*   **Назначение:** **Именованный модуль программы**, хранящийся на сервере БД и содержащий последовательность операторов SQL и процедурных команд (T-SQL, PL/SQL).
*   **Свойства:** Может принимать входные параметры и возвращать выходные. Выполняется на сервере.
*   **Применение:** Инкапсуляция сложной бизнес-логики, снижение сетевого трафика (один вызов вместо множества запросов), централизация логики и безопасности.

#### **8. Пользовательская функция (User-Defined Function, UDF)**
*   **Назначение:** Подпрограмма, которая **возвращает единственное скалярное значение или таблицу**. В отличие от процедуры, может использоваться непосредственно в SQL-запросах (`SELECT`, `WHERE`).
*   **Типы:**
    *   **Скалярная:** Возвращает одно значение.
    *   **Табличная:** Возвращает таблицу. Может быть inline (одно выражение) или multi-statement (сложная логика).
*   **Ограничение:** Обычно не может модифицировать данные (нет DML-операций, кроме исключений).

---

### **Категория 4. Объекты безопасности и управления доступом**

#### **9. Схема данных (Schema)**
*   **Назначение:** **Пространство имен и контейнер** для объектов БД (таблиц, представлений, процедур) внутри одной базы данных. Отделяет логическую группировку от физического хранения.
*   **Роль:**
    1.  **Организация:** Группировка объектов по принадлежности (например, схема `sales` для таблиц о продажах, `hr` — для кадров).
    2.  **Управление доступом:** Права можно выдавать на всю схему целиком.
*   **Пример:** `CREATE TABLE hr.employees (...)` — таблица `employees` в схеме `hr`.

#### **10. Пользователь (User) и Логин (Login)**
*   **Логин (Login/Principal сервера):** Учетная запись для **входа на экземпляр сервера СУБД**. Существует на уровне сервера.
*   **Пользователь (User):** Учетная запись, **связанная с логином (или без него) внутри конкретной базы данных**. Именно пользователю выдаются права на объекты этой БД.
*   **Взаимосвязь:** Один **логин** может быть сопоставлен с одним **пользователем** в каждой БД, куда ему нужен доступ. Например, логин `domain\ivanov` → пользователь `ivanov_db` в БД `Sales`.

#### **11. Роль (Role)**
*   **Назначение:** Группа для упрощенного управления правами доступа. Вместо выдачи прав каждому пользователю отдельно, права выдаются роли, а роль назначается пользователям.
*   **Типы:**
    *   **Предопределенные роли сервера/БД:** `sysadmin`, `db_owner`, `db_datareader` (имеют фиксированный набор привилегий).
    *   **Пользовательские роли:** Создаются администратором для конкретных бизнес-ролей (`role_analyst`, `role_operator`).
*   **Пример:** `GRANT SELECT ON SCHEMA::Sales TO role_analyst`. Затем: `ALTER ROLE role_analyst ADD MEMBER ivanov_db`.

#### **12. Правило (Rule) и Ограничение (Constraint)**
*   **Ограничение (CONSTRAINT):** Основной современный механизм обеспечения целостности данных.
    *   `PRIMARY KEY`, `FOREIGN KEY` — ссылочная целостность.
    *   `CHECK` — проверка значений по условию (`Salary > 0`).
    *   `UNIQUE` — уникальность.
    *   `NOT NULL` — запрет NULL.
*   **Правило (RULE):** **Устаревший** объект в некоторых СУБД (например, SQL Server), аналогичный ограничению `CHECK`, но создаваемый отдельно и затем привязываемый к столбцам или типам данных. В современных реализациях практически вытеснено ограничениями `CHECK` и пользовательскими типами.

---

### **Итоговая систематизация и взаимосвязи**

```
Экземпляр СУБД (Instance)
        |
        |--- Логины (Logins) [Уровень сервера]
        |
        |--- Базы данных (Databases)
                |
                |--- Схемы (Schemas) -> Контейнеры для объектов
                |       |
                |       |--- Таблицы (Tables) / Отношения (Relations)
                |       |       |--- Индексы (Indexes)
                |       |       |--- Ограничения (Constraints)
                |       |
                |       |--- Представления (Views)
                |       |
                |       |--- Хранимые процедуры (Stored Procedures)
                |       |
                |       |--- Пользовательские функции (UDF)
                |
                |--- Пользователи (Users) [Связаны с логинами]
                |
                |--- Роли (Roles) -> Назначаются пользователям
                |
                |--- Пользовательские типы данных (UDT)
```

**Ключевой принцип:** Объекты от **таблиц** до **процедур** обеспечивают **хранение и обработку** данных. Объекты от **схем** до **ролей** обеспечивают **безопасность, организацию и управление доступом** к этим данным.