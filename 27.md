### Not only SQL системы. Нереляционные базы данных

### **Часть 1. Концепция NoSQL и теоретические основы**

#### **1.1. Определение и причины появления**

**NoSQL (Not Only SQL)** — класс систем управления базами данных, которые отличаются от традиционных реляционных СУБД отказом от использования реляционной модели, SQL-языка и часто — от гарантий ACID.

**Причины возникновения (2000-е годы):**
1. **Взрывной рост данных** (Web 2.0, социальные сети)
2. **Необходимость горизонтального масштабирования** (шардирование)
3. **Несоответствие реляционной модели** для неструктурированных данных
4. **Высокие требования к производительности** (миллионы операций в секунду)

#### **1.2. CAP-теорема (Brewer's Theorem)**

**Формулировка:** В распределенной системе можно обеспечить не более двух из трех свойств одновременно:

- **C (Consistency)** — согласованность: все узлы видят одни и те же данные одновременно
- **A (Availability)** — доступность: система всегда отвечает на запросы
- **P (Partition tolerance)** — устойчивость к разделению: система работает при разрыве связи между узлами

**Практические следствия:**
- **CA-системы:** Традиционные RDBMS (Oracle, MySQL), жертвуют P
- **CP-системы:** MongoDB, Redis, HBase — доступность при разделении
- **AP-системы:** Cassandra, DynamoDB, CouchDB — eventual consistency

#### **1.3. BASE-принципы (в противовес ACID)**

- **Basically Available** — базовая доступность
- **Soft state** — мягкое состояние (данные могут меняться без обновления)
- **Eventual consistency** — конечная согласованность

**Eventual consistency модели:**
- **Read-your-writes:** Клиент видит свои записи
- **Monotonic reads:** Клиент не видит более старые данные
- **Monotonic writes:** Записи выполняются в порядке отправки

### **Часть 2. Типы NoSQL баз данных**

#### **2.1. Документные базы данных (Document Stores)**

**Концепция:** Данные хранятся как документы (JSON, BSON, XML), обычно с гибкой схемой.

**Преимущества:**
- Естественное представление объектов приложения
- Гибкая схема (schemaless)
- Вложенные структуры данных
- Простота разработки

**Примеры:** MongoDB, CouchDB, Couchbase, DocumentDB

**Сценарии использования:**
- Каталоги товаров (e-commerce)
- Контент-менеджмент системы
- Пользовательские профили
- Логи приложений

#### **2.2. Хранилища "ключ-значение" (Key-Value Stores)**

**Концепция:** Простейшая модель — хэш-таблица в распределенном виде.

**Характеристики:**
- Высокая производительность (O(1) доступ)
- Простая модель данных
- Часто in-memory для максимальной скорости
- Ограниченные возможности запросов

**Примеры:** Redis, DynamoDB, Riak, etcd

**Сценарии использования:**
- Кэширование сессий
- Корзины покупок
- Конфигурации приложений
- Счетчики и метрики

#### **2.3. Колоночные базы данных (Column-family / Wide-column Stores)**

**Концепция:** Данные хранятся по столбцам, а не по строкам. Каждая строка может иметь разные столбцы.

**Особенности:**
- Оптимизированы для чтения больших объемов
- Эффективное сжатие (однотипные данные в столбцах)
- Масштабируемость на сотни узлов

**Примеры:** Cassandra, HBase, ScyllaDB

**Сценарии использования:**
- Аналитика в реальном времени
- Хранение временных рядов
- Рекомендательные системы
- IoT и телеметрия

#### **2.4. Графовые базы данных (Graph Databases)**

**Концепция:** Оптимизированы для хранения и обработки связанных данных (узлы, ребра, свойства).

**Преимущества:**
- Эффективные запросы к связанным данным
- Естественное моделирование социальных сетей
- Обход графов за постоянное время

**Примеры:** Neo4j, Amazon Neptune, JanusGraph

**Сценарии использования:**
- Социальные сети (друзья друзей)
- Рекомендательные системы
- Обнаружение мошенничества
- Семантические сети

#### **2.5. Сравнительная таблица типов NoSQL**

| Тип | Модель данных | Оптимизация | Сложность | Примеры |
|-----|--------------|-------------|-----------|---------|
| **Документная** | JSON/BSON документы | Гибкая схема, вложенность | Средняя | MongoDB, CouchDB |
| **Ключ-значение** | Хэш-таблица | Скорость, простота | Низкая | Redis, DynamoDB |
| **Колоночная** | Столбцовые семейства | Чтение, сжатие | Высокая | Cassandra, HBase |
| **Графовая** | Узлы и ребра | Связи, обходы | Высокая | Neo4j, Neptune |

### **Часть 3. Сравнение с реляционными СУБД**

#### **3.1. Реляционные vs NoSQL**

| Критерий | **RDBMS** | **NoSQL** |
|----------|-----------|-----------|
| **Модель данных** | Таблицы, строки, столбцы | Документы, ключ-значение, графы |
| **Схема** | Строгая, фиксированная | Гибкая, динамическая |
| **Масштабирование** | Вертикальное (scale-up) | Горизонтальное (scale-out) |
| **Язык запросов** | SQL (стандартизированный) | Специфичные API, иногда SQL-like |
| **Согласованность** | Строгая (ACID) | Ослабленная (BASE) |
| **Транзакции** | Полная поддержка | Ограниченная или отсутствует |
| **JOIN операции** | Мощные, сложные | Ограниченные или отсутствуют |
| **Использование** | Сложные запросы, отчеты | Большие объемы, высокая нагрузка |

#### **3.2. Полиглотное хранение (Polyglot Persistence)**

**Концепция:** Использование разных типов БД для разных задач в одном приложении.

**Пример архитектуры:**
```
Приложение e-commerce:
- PostgreSQL: Заказы, инвентарь (транзакционные данные)
- MongoDB: Каталог товаров, отзывы (документы)
- Redis: Корзины покупок, кэш (ключ-значение)
- Neo4j: Рекомендации ("смотрите также")
- Cassandra: Аналитика поведения
```

**Преимущества:**
- Выбор оптимального инструмента для каждой задачи
- Улучшение производительности
- Гибкость в развитии системы

**Вызовы:**
- Сложность администрирования
- Согласованность между разными БД
- Необходимость знаний разных технологий

#### **3.3. Критерии выбора: SQL vs NoSQL**

**Выбирайте SQL/RDBMS когда:**
1. Требуются сложные запросы и агрегации
2. Важны транзакции и согласованность данных
3. Данные хорошо структурированы
4. Нужны сложные JOIN операции
5. Есть требования к отчетности и аналитике

**Выбирайте NoSQL когда:**
1. Ожидается быстрый рост объема данных
2. Требуется горизонтальное масштабирование
3. Данные слабо структурированы или меняются часто
4. Высокие требования к производительности записи/чтения
5. Приложение работает в распределенной среде

### **Часть 4. Гибридные и современные подходы**

#### **4.1. NewSQL системы**

**Концепция:** Сочетают преимущества SQL (ACID, SQL-интерфейс) и NoSQL (горизонтальная масштабируемость).

**Примеры:**
- **Google Spanner:** Глобально распределенная, с внешними часами
- **CockroachDB:** Распределенная, PostgreSQL-совместимая
- **YugabyteDB:** PostgreSQL и Cassandra API

**Характеристики:**
- Горизонтальное масштабирование
- Полная поддержка ACID
- SQL-интерфейс
- Распределенные транзакции

#### **4.2. Мультимодельные базы данных**

**Концепция:** Одна система поддерживает несколько моделей данных.

**Примеры:**
- **Azure Cosmos DB:** Документы, графы, ключ-значение, колоночные
- **ArangoDB:** Документы, графы, ключ-значение
- **OrientDB:** Документы, графы, объекты

**Преимущества:**
- Единая точка администрирования
- Снижение сложности интеграции
- Гибкость в использовании моделей данных

#### **4.3. Операционно-аналитические системы (HTAP)**

**Hybrid Transactional/Analytical Processing:**
- Одновременная поддержка OLTP и OLAP
- Примеры: ClickHouse, MemSQL, SAP HANA
- Позволяют анализировать свежие данные без ETL

#### **4.4. Векторные базы данных для AI**

**Для работы с embeddings и семантическим поиском:**
- Pinecone, Weaviate, Qdrant
- Используются в RAG-архитектурах, рекомендательных системах

### **Часть 5. Практические рекомендации**

#### **5.1. Проектирование для NoSQL**

**Ключевые принципы:**
1. **Денормализация:** Дублирование данных для скорости чтения
2. **Шардирование:** Распределение данных по узлам
3. **Кэширование:** Использование in-memory слоев
4. **Eventual consistency:** Проектирование с учетом задержек синхронизации

#### **5.2. Паттерны доступа к данным**

1. **Командное разделение ответственности (CQRS):**
   - Разделение на команды (запись) и запросы (чтение)
   - Разные оптимизации для разных операций

2. **Событийное проектирование (Event Sourcing):**
   - Хранение всех изменений как событий
   - Воспроизведение состояния на любой момент времени

3. **Материализованные представления:**
   - Предварительно вычисленные агрегаты
   - Обновление асинхронно

#### **5.3. Мониторинг и эксплуатация**

**Ключевые метрики для NoSQL:**
- P99 latency (задержка 99-го процентиля)
- Throughput (операций в секунду)
- Утилизация ресурсов
- Задержки репликации
- Размеры кластеров

## **3. Заключение**

### **Ключевые выводы:**

1. **NoSQL — не замена, а дополнение:** Полиглотное хранение — современный стандарт.
2. **Выбор модели зависит от задачи:** Разные NoSQL БД решают разные проблемы.
3. **Компромиссы неизбежны:** Между согласованностью, доступностью и производительностью.
4. **Эволюция продолжается:** NewSQL и мультимодельные системы стирают границы.

### **Тренды развития:**

1. **Конвергенция SQL и NoSQL:** Единые интерфейсы, распределенные транзакции.
2. **Управление через код:** Infrastructure as Code для БД.
3. **Serverless базы данных:** Автоматическое масштабирование, оплата за использование.
4. **AI-интеграция:** Векторные БД для ML, автооптимизация.
5. **Глобальное распределение:** Базы данных как глобальные сервисы.

### **Итог:**

NoSQL системы изменили парадигму работы с данными, сместив акцент с **согласованности** на **масштабируемость** и **производительность**. Современные приложения все чаще используют **гибридные подходы**, выбирая оптимальный инструмент для каждой задачи. Успешное использование NoSQL требует не только технических знаний, но и **изменения мышления** — от реляционной нормализации к денормализации, от глобальной согласованности к eventual consistency, от универсальности к специализации.