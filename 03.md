### Языки описания данных(transact sql, pl/sql), язык манипулирования данными (SQL)

В реляционных СУБД работа с данными строится на основе языка **SQL (Structured Query Language)**. Однако для реализации сложной бизнес-логики на стороне сервера базовый декларативного SQL был расширен процедурными возможностями, что привело к появлению диалектов, наиболее известными из которых являются **Transact-SQL (T-SQL)** и **PL/SQL**.

### **Часть 1. SQL (Structured Query Language) — универсальный язык манипулирования данными**

**SQL** — это **декларативный** язык стандарта ISO/IEC, предназначенный для управления данными в реляционных СУБД. Пользователь описывает *«что нужно получить»*, а не *«как это сделать»* (план выполнения формирует СУБД).

**Основные группы операторов SQL (по назначению):**

1.  **DDL (Data Definition Language) — язык определения данных.** Операторы для создания, изменения и удаления структуры объектов БД (схемы).
    *   `CREATE` (создать таблицу, индекс,视图)
    *   `ALTER` (изменить объект)
    *   `DROP` (удалить объект)
    *   `TRUNCATE` (очистить таблицу)

2.  **DML (Data Manipulation Language) — язык манипулирования данными.** Ядро SQL для работы с данными внутри таблиц.
    *   `SELECT` — извлечение данных (часто выделяют в отдельную группу **DQL**).
    *   `INSERT` — добавление новых строк.
    *   `UPDATE` — изменение существующих строк.
    *   `DELETE` — удаление строк.
    *   `MERGE` (Upsert) — вставка или обновление.

3.  **DCL (Data Control Language) — язык управления доступом.**
    *   `GRANT` — предоставить права на объект.
    *   `REVOKE` — отозвать права.

4.  **TCL (Transaction Control Language) — язык управления транзакциями.**
    *   `COMMIT` — подтвердить транзакцию.
    *   `ROLLBACK` — откатить транзакцию.
    *   `SAVEPOINT` — установить точку сохранения внутри транзакции.

**Ключевые особенности базового SQL:**
*   **Декларативность:** Описывается результат, а не алгоритм.
*   **Наборо-ориентированность:** Операции работают с наборами строк (например, `UPDATE` всех строк, удовлетворяющих условию).
*   **Стандартизация:** Существуют стандарты SQL-92, SQL:1999, SQL:2003 и т.д., но каждая СУБД реализует свой **диалект** с расширениями.

---

### **Часть 2. Процедурные расширения SQL: PL/SQL и Transact-SQL**

Базовый SQL не поддерживает процедурные конструкции (циклы, условия, развитую обработку ошибок), необходимые для реализации сложной логики непосредственно в БД. Это привело к созданию **процедурных расширений**.

| **Критерий** | **PL/SQL (Oracle)** | **Transact-SQL (Microsoft SQL Server, Sybase)** | **Базовый SQL** |
| :--- | :--- | :--- | :--- |
| **Парадигма** | **Процедурное** расширение, **блочно-структурированный** язык. | **Процедурное** расширение, набор дополнений к SQL. | **Декларативный** язык. |
| **Архитектурная модель** | Основан на **блоках** (`BEGIN ... END`). Каждый исполняемый файл — это блок (анонимный или именованный). Сильная интеграция с объектами Oracle. | Основан на **пакетах команд и процедур**. Менее строгая блочная структура, более близок к последовательному выполнению скриптов. | Основан на **отдельных операторах** или **наборах операторов**. |
| **Обработка данных** | **Операции с курсорами** для построчной обработки результатов SELECT. Явное объявление и управление курсорами. | **Неявные курсоры** в циклах (`WHILE`, `CURSOR`). Активное использование временных таблиц и табличных переменных для промежуточных результатов. | Только **наборо-ориентированные** операции. |
| **Основные объекты** | Процедуры, функции, пакеты (объединение процедур/функций), триггеры, **анонимные блоки**. | Процедуры, функции, триггеры, **скрипты**. Понятие «пакета» отсутствует. | Нет понятия процедурных объектов. |
| **Обработка ошибок** | Механизм **`EXCEPTION`** с именованными системными и пользовательскими исключениями в специальной секции блока. | Конструкция **`TRY...CATCH`**, проверка `@@ERROR`. | Элементарная (зависит от реализации СУБД). |
| **Типичный синтаксис** | `DECLARE ... BEGIN ... EXCEPTION ... END;` | `BEGIN ... END` для группировки, но без обязательного `DECLARE` в начале блока. Использует `GO` как разделитель пакетов команд. | Отдельные операторы `SELECT`, `UPDATE` и т.д. |
| **Основное применение** | Реализация сложной бизнес-логики на стороне сервера Oracle, ETL-процессы, создание API для данных. | Администрирование, скрипты для отчетов, серверная логика в MS SQL Server, интеграция с .NET (CLR). | Запросы, модификация данных, управление схемой. |

---

### **Часть 3. Сценарии применения и сравнение**

| **Сценарий** | **Базовый SQL** | **PL/SQL / T-SQL** |
| :--- | :--- | :--- |
| **Создание отчета со сложной агрегацией** | **Идеально.** Один сложный запрос `SELECT` с `JOIN`, `GROUP BY`, оконными функциями. | Может быть избыточен, но полезен для пошаговой обработки или если нужна сложная переменная логика. |
| **Пакетное обновление данных по условию** | **Идеально.** `UPDATE ... WHERE ...` | Может использоваться, если обновление требует итеративной логики (например, обход курсора). |
| **Реализация многошаговой бизнес-транзакции** (например, «перевод денег между счетами») | **Недостаточно.** Нужны атомарность и последовательность шагов. | **Основное применение.** Процедура с `BEGIN TRANSACTION`, несколькими DML-операциями, проверками и `COMMIT/ROLLBACK` в секции обработки ошибок. |
| **Валидация и комплексная обработка данных при вставке (триггер)** | Ограниченно (`CHECK`-ограничения). | **Идеально.** Триггеры, написанные на PL/SQL или T-SQL, позволяют выполнять произвольную логику до/после DML-события. |
| **Созрение серверного API** (например, метод «создать заказ») | Невозможно. | **Основное применение.** Создание хранимой процедуры `CreateOrder`, которую вызывает клиентское приложение. Это инкапсулирует логику и повышает безопасность. |
| **Административные задачи** (бэкап, обслуживание) | Частично. | **Основное применение.** Написание скриптов (T-SQL) или пакетов (PL/SQL) для автоматизации. |

**Важный вывод:**
*   **SQL** — это **фундамент**. Им должен владеть каждый разработчик и администратор БД.
*   **Transact-SQL и PL/SQL** — это **мощные инструменты для переноса бизнес-логики на уровень сервера БД**. Они уменьшают сетевой трафик (вместо 10 запросов выполняется одна процедура), централизуют и защищают логику, но могут создавать нагрузку на сервер БД и усложнять миграцию между СУБД разных вендоров.
*   **Современный тренд** — разумное использование хранимых процедур. Часть логики может оставаться в приложении, особенно в микросервисной архитектуре, но для критичных с точки зрения целостности данных и производительности операций PL/SQL/T-SQL остаются незаменимыми.

---

**Дополнительный вопрос для экзамена (устно):** *«В чем основное архитектурное различие между подходом PL/SQL и подходом T-SQL к обработке наборов данных?»*
**Ответ:** PL/SQL явно ориентирован на **блочную структуру и работу через явные курсоры**, часто требуя описания типа курсора. T-SQL чаще использует **неявные циклы по результату запроса** (например, `WHILE` или курсор в стиле `DECLARE CURSOR ... FOR SELECT`) и активно оперирует **промежуточными табличными результатами** (табличные переменные, временные таблицы).